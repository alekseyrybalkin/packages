pkgname=postgresql
pkgver=12.1
vcs=git
gittag=REL_${pkgver//\./_}
relmon_id=5601

build() {
    ./configure --prefix=/usr \
        --sysconfdir=/etc \
        --enable-thread-safety \
        --with-system-tzdata=/usr/share/zoneinfo \
        --build=x86_64-unknown-linux-gnu \
        --docdir=/usr/share/doc/postgresql
    make
}

package() {
    make DESTDIR=${pkgdir} install
    make -C contrib DESTDIR=${pkgdir} install
    mkdir -p ${pkgdir}/etc/postgresql
    echo '\set HISTFILE /dev/null' > ${pkgdir}/etc/postgresql/psqlrc
}

after_install() {
    install -v -m700 -d /var/lib/postgres/data
    getent group postgres >/dev/null || groupadd -g 41 postgres
    getent passwd postgres >/dev/null || \
        useradd -c "PostgreSQL Server" -g postgres -d /var/lib/postgres/data \
        -u 41 postgres
    chown -v postgres /var/lib/postgres/data
    su - postgres -c '/usr/bin/initdb -D /var/lib/postgres/data'
}

after_upgrade() {
    :
}
