pkgname=boost
pkgver=1.71.0
vcs=git
gittag=boost-${pkgver}
relmon_id=6845

build() {
    cd libs
    cat ../.gitmodules | grep submodule | sed 's/\[submodule "//g' | sed 's/"\]//g' | sed 's/libs\///g' | while read module; do
        git clone -s -n `find_vcs_repo boost-${module}` ${module}
        cd ${module}
        git checkout ${gittag}
        cd ../
    done
    cd ../
    mv libs/{inspect,boostbook,bcp,build,quickbook,litre,auto_index,boostdep,check_build,boost_install} tools/
    mkdir boost
    for lib in `find libs -maxdepth 1 -mindepth 1 -type d`; do
        if [ -d ${lib}/include/boost ]; then
            cp -rv ${lib}/include/boost/* boost/
            rm -rf ${lib}/include
        fi
    done
    ./bootstrap.sh --prefix=/usr
    ./b2 stage \
        threading=multi \
        link=shared \
        `sed -e 's/.*\(-j *[0-9]\+\).*/\1/' <<< ${MAKEFLAGS}`
}

package() {
    ./b2 --prefix=${pkgdir}/usr install threading=multi link=shared
}
