pkgname=mesa
pkgver=20.2.3
vcs=git
gittag=mesa-${pkgver}
relmon_id=1970
updater_rules='skip_big_first'

build() {
    mkdir build
    meson --prefix=/usr \
        -D b_lto=false \
        -D b_ndebug=true \
        -D platforms=x11 \
        -D dri-drivers='i965,swrast' \
        -D gallium-drivers='' \
        -D vulkan-drivers='' \
        -D swr-arches=avx,avx2 \
        -D dri3=enabled \
        -D egl=enabled \
        -D gbm=enabled \
        -D gles1=disabled \
        -D gles2=enabled \
        -D glx=dri \
        -D llvm=false \
        -D osmesa=classic \
        -D shared-glapi=enabled \
        -D valgrind=false \
        -D libunwind=false \
        -D zstd=disabled \
        . build
    ninja -C build
}

package() {
    DESTDIR=${pkgdir} ninja -C build install
    mkdir -pv ${pkgdir}/usr/share/doc/mesa
    cp -rfv docs/* ${pkgdir}/usr/share/doc/mesa
}
