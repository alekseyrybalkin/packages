pkgname=palemoon
pkgver=29.0.1
vcs=git
gittag=${pkgver}_Release
updater_rules="no_alpha_skips,skip_rc"

build() {
    git submodule init
    git config submodule.platform.url `find_vcs_repo uxp`
    git submodule update

    cp ../mozconfig .

    patch -Np1 -i ../customizations.patch

    export MOZBUILD_STATE_PATH=${srcdir}/mozbuild
    export MOZCONFIG=${srcdir}/mozconfig
    export CPPFLAGS="${CPPFLAGS} -O2 -Wno-format-overflow"
    export CCACHE_SLOPPINESS=file_macro,locale,time_macros

    ./mach build
}

package() {
    cd obj-x86_64-pc-linux-gnu
    make package
    cd dist
    install -d ${pkgdir}/usr/{bin,lib}
    cp -r palemoon/ ${pkgdir}/usr/lib/${pkgname}
    ln -s ../lib/${pkgname}/palemoon ${pkgdir}/usr/bin/palemoon
}
