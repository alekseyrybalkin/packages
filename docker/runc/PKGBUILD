pkgname=runc
_pkgver=1.0.0
_rc=10
pkgver=${_pkgver}.rc${_rc}
ARCH_VERSION=${_pkgver}rc${_rc}
vcs=git
gittag=v${_pkgver}-rc${_rc}
relmon_id=7462
updater_rules="no_alpha_skips"

build() {
    cd ${location}
    mkdir -p src/github.com/opencontainers
    cp -r ${srcdir} src/github.com/opencontainers/runc
    cd src/github.com/opencontainers/runc

    export EXTRA_FLAGS="-gcflags all=-trimpath=${PWD} -asmflags all=-trimpath=${PWD}"
    export GOPATH=${location}
    export LDFLAGS="-Wl,-O1,--sort-common,--as-needed,-z,relro,-z,now"
    export EXTRA_LDFLAGS="-extldflags ${LDFLAGS}"
    export BUILDTAGS="seccomp"

    make runc
}

package() {
    cd ${location}/src/github.com/opencontainers/runc
    install -Dm755 runc ${pkgdir}/usr/bin/runc
}
