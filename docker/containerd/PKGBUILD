pkgname=containerd
pkgver=1.3.1
_commit=c7a4f874b3267c499484aae602d1257b12d69e40
vcs=git
gittag=v${pkgver}
relmon_id=16460
relmon_rules="skip_rc,skip_b"

build() {
    sed -i -e 's/opt\/containerd/tmp\/containerd/g' services/opt/path_unix.go

    cd ${location}
    mkdir -p src/github.com/containerd
    cp -r ${srcdir} src/github.com/containerd/containerd
    cd src/github.com/containerd/containerd

    export GOPATH=${location}
    export LDFLAGS="-Wl,-O1,--sort-common,--as-needed,-z,relro,-z,now"
    export EXTRA_LDFLAGS="-extldflags ${LDFLAGS}"
    make VERSION=v${pkgver}.m REVISION=${_commit}.m
}

package() {
    export GOPATH=${location}
    cd ${location}/src/github.com/containerd/containerd
    make install DESTDIR=${pkgdir}/usr
    rm -rf ${pkgdir}/opt
}
