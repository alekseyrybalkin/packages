pkgname=openjdk
pkgver=14
_build=36
vcs=mercurial
hgtag=jdk-${pkgver}+${_build}
updater_rules='no_alpha_skips,lstrip_jdk,skip_+'

build() {
    patch -Np1 -i ../make4.3.patch

    PATH=/usr/bin

    unset MAKEFLAGS
    bash configure --enable-unlimited-crypto \
        --with-boot-jdk=/usr/lib/openjdk \
        --disable-warnings-as-errors \
        --with-stdc++lib=dynamic \
        --with-giflib=system \
        --with-lcms=system \
        --with-libjpeg=system \
        --with-libpng=system \
        --with-zlib=system \
        --with-version-build="${_build}" \
        --with-version-pre="" \
        --with-version-opt="" \
        --with-jobs=4 \
        --with-extra-cflags="${CFLAGS}" \
        --with-extra-cxxflags="${CXXFLAGS}"
    make images
}

package() {
    mkdir -p ${pkgdir}/usr/lib/openjdk
    cp -rv build/*/images/jdk/* ${pkgdir}/usr/lib/openjdk/
    rm -vf ${pkgdir}/usr/lib/openjdk/lib/security/cacerts
    mkdir -pv ${pkgdir}/usr/lib/jvm/
    ln -sv /usr/lib/openjdk ${pkgdir}/usr/lib/jvm/default-runtime
}
