pkgname=python-sphinx
pkgver=2.4.4
vcs=git
vcs_pkgname=sphinx
gittag=v${pkgver}
relmon_id=4031
contrib="qthelp serializinghtml websupport htmlhelp jsmath devhelp applehelp log-cabinet"

build() {
    # disable snowballstemmer
    sed -i -e '/snowballstemmer/d' setup.py
    sed -i -e "/: 'sphinx.search/d" sphinx/search/__init__.py

    make build

    for c in ${contrib}; do
        git clone `find_vcs_repo sphinxcontrib-${c}`
    done
}

package() {
    pip install \
        --no-deps \
        --no-build-isolation \
        --ignore-installed \
        --compile \
        --prefix=/usr \
        --root=${pkgdir} .

    for c in ${contrib}; do
        cd sphinxcontrib-${c}
        pip install \
            --no-deps \
            --no-build-isolation \
            --ignore-installed \
            --compile \
            --prefix=/usr \
            --root=${pkgdir} .
        cd ..
    done
}
