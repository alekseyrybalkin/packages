pkgname=python-pytz
pkgver=2020.1
vcs=git
vcs_pkgname=pytz
gittag=release_${pkgver}
relmon_id=6537

build() {
    patch -Np1 -i ../gen_tzdata_fix.patch
    MAKEFLAGS=
    sed -i -e 's/python2.4/python2.7/g' Makefile
    sed -i -e 's/python2.5/python2.7/g' Makefile
    sed -i -e 's/python2.6/python2.7/g' Makefile
    sed -i -e 's/python3.1/python3.8/g' Makefile
    sed -i -e 's/python3.2/python3.8/g' Makefile
    sed -i -e 's/python3.3/python3.8/g' Makefile
    sed -i -e 's/python3.4/python3.8/g' Makefile
    sed -i -e 's/python3.5/python3.8/g' Makefile
    sed -i -e 's/python3.6/python3.8/g' Makefile
    sed -i -e 's/python3.7/python3.8/g' Makefile
    make build wheels
    python gen_tzinfo.py
    cd src
    python setup.py build
}

package() {
    PYVERSION=`python -c "import sys; print('{}.{}'.format(sys.version_info.major, sys.version_info.minor))"`
    cd src
    python setup.py install --root=${pkgdir}
    cp -r ../build/dist/build/lib/pytz/* ${pkgdir}/usr/lib/python${PYVERSION}/site-packages/pytz
}
