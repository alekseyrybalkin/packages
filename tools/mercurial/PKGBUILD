pkgname=mercurial
pkgver=5.2.2
vcs=mercurial
hgtag=${pkgver}
relmon_id=1969
relmon_rules="skip_rc"

build() {
    # Fix pickle protocal to 3 (for python 3.8 which defaults to 4)
    patch -Np1 -i ../pickle_protocol_fix.patch

    export HGPYTHON3=1
    cd doc
    make
}

package() {
    export HGPYTHON3=1
    python setup.py install --root=${pkgdir}/ --optimize=1
    install -d ${pkgdir}/usr/share/man/{man1,man5}
    install -m644 doc/hg.1 ${pkgdir}/usr/share/man/man1
    install -m644 doc/{hgrc.5,hgignore.5} ${pkgdir}/usr/share/man/man5
}
