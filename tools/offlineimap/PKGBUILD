pkgname=offlineimap
pkgver=7.2.4
vcs=git
gittag=v${pkgver}
relmon_id=2534

build() {
    sed -i -e 's/linux-arch/linux-jinni/g' offlineimap/utils/distro.py
    sed -i -e 's/arch-release/jinni-release/g' offlineimap/utils/distro.py

    # python3
    sed -i -e 's/python2/python/g' offlineimap.py bin/offlineimap
    patch -Np1 -i ../python3.patch

    python setup.py build
    cd docs
    make man
}

package() {
    python setup.py install --root=${pkgdir} --optimize=1
    install -Dm644 docs/offlineimap.1 ${pkgdir}/usr/share/man/man1/offlineimap.1
    install -Dm644 docs/offlineimapui.7 ${pkgdir}/usr/share/man/man7/offlineimapui.7
    install -Dm644 offlineimap.conf ${pkgdir}/usr/share/offlineimap/offlineimap.conf
    install -Dm644 offlineimap.conf.minimal ${pkgdir}/usr/share/offlineimap/offlineimap.conf.minimal

    #systemd files
    install -Dm644 contrib/systemd/${pkgname}.service ${pkgdir}/usr/lib/systemd/user/${pkgname}.service
    install -Dm644 contrib/systemd/${pkgname}@.service ${pkgdir}/usr/lib/systemd/user/${pkgname}@.service
    install -Dm644 contrib/systemd/${pkgname}-oneshot.service ${pkgdir}/usr/lib/systemd/user/${pkgname}-oneshot.service
    install -Dm644 contrib/systemd/${pkgname}-oneshot.timer ${pkgdir}/usr/lib/systemd/user/${pkgname}-oneshot.timer
    install -Dm644 contrib/systemd/${pkgname}-oneshot@.service ${pkgdir}/usr/lib/systemd/user/${pkgname}-oneshot@.service
    install -Dm644 contrib/systemd/${pkgname}-oneshot@.timer ${pkgdir}/usr/lib/systemd/user/${pkgname}-oneshot@.timer
}
