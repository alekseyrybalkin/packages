diff --git a/offlineimap/bundled_imaplib2.py b/offlineimap/bundled_imaplib2.py
index 1fd47d2..6a07ee8 100755
--- a/offlineimap/bundled_imaplib2.py
+++ b/offlineimap/bundled_imaplib2.py
@@ -301,10 +301,6 @@ class IMAP4(object):
     class readonly(abort): pass     # Mailbox status changed to READ-ONLY
 
 
-    # These must be encoded according to utf8 setting in _mode_xxx():
-    _literal = br'.*{(?P<size>\d+)}$'
-    _untagged_status = br'\* (?P<data>\d+) (?P<type>[A-Z-]+)( (?P<data2>.*))?'
-
     continuation_cre = re.compile(r'\+( (?P<data>.*))?')
     mapCRLF_cre = re.compile(r'\r\n|\r|\n')
         # Need to quote "atom-specials" :-
@@ -317,6 +313,14 @@ class IMAP4(object):
 
     def __init__(self, host=None, port=None, debug=None, debug_file=None, identifier=None, timeout=None, debug_buf_lvl=None):
 
+        # These must be encoded according to utf8 setting in _mode_xxx():
+        if bytes != str:
+            self._literal = r'.*{(?P<size>\d+)}$'
+            self._untagged_status = r'\* (?P<data>\d+) (?P<type>[A-Z-]+)( (?P<data2>.*))?'
+        else:
+            self._literal = br'.*{(?P<size>\d+)}$'
+            self._untagged_status = br'\* (?P<data>\d+) (?P<type>[A-Z-]+)( (?P<data2>.*))?'
+
         self.state = NONAUTH            # IMAP4 protocol state
         self.literal = None             # A literal argument to a command
         self.tagged_commands = {}       # Tagged commands awaiting response
diff --git a/offlineimap/folder/Maildir.py b/offlineimap/folder/Maildir.py
index f061bcd..6cca3df 100644
--- a/offlineimap/folder/Maildir.py
+++ b/offlineimap/folder/Maildir.py
@@ -74,7 +74,10 @@ class MaildirFolder(BaseFolder):
         # Everything up to the first comma or colon (or ! if Windows):
         self.re_prefixmatch = re.compile('([^'+ self.infosep + ',]*)')
         # folder's md, so we can match with recorded file md5 for validity.
-        self._foldermd5 = md5(self.getvisiblename()).hexdigest()
+        visible_name = self.getvisiblename()
+        if bytes != str:
+            visible_name = visible_name.encode()
+        self._foldermd5 = md5(visible_name).hexdigest()
         # Cache the full folder path, as we use getfullname() very often.
         self._fullname = os.path.join(self.getroot(), self.getname())
         # Modification time from 'Date' header.
diff --git a/offlineimap/imapserver.py b/offlineimap/imapserver.py
index 600ce65..67c874e 100644
--- a/offlineimap/imapserver.py
+++ b/offlineimap/imapserver.py
@@ -215,8 +215,14 @@ class IMAPServer(object):
         # At this point all authz, authc and passwd are expected bytes encoded
         # in UTF-8.
         NULL = b'\x00'
+
+        if bytes != str:
+            authc = authc.encode()
+            passwd = passwd.encode()
+
         retval = NULL.join((authz, authc, passwd))
         logsafe_retval = NULL.join((authz, authc, b'(passwd hidden for log)'))
+
         self.ui.debug('imap', '__plainhandler: returning %s'% logsafe_retval)
         return retval
 
diff --git a/offlineimap/utils/distro.py b/offlineimap/utils/distro.py
index 87bb2b1..f4140f7 100644
--- a/offlineimap/utils/distro.py
+++ b/offlineimap/utils/distro.py
@@ -70,7 +70,7 @@ def get_os_sslcertfile_searchpath():
     l = None
     if OS in __DEF_OS_LOCATIONS:
         l = __DEF_OS_LOCATIONS[OS]
-        if not hasattr(l, '__iter__'):
+        if isinstance(l, str):
             l = (l, )
     return l
 
