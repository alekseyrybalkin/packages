pkgname=gtk
pkgver=3.24.26
vcs=git
gittag=${pkgver}
relmon_id=10018
updater_rules="skip_big_second"

build() {
    # disable accessibility
    sed -i -e '/bridge/d' gtk/a11y/gtkaccessibility.c
    sed -i -e 's/atkbridge_dep,//g' gtk/meson.build
    sed -i -e '/atkbridge_dep/d' meson.build

    meson --prefix=/usr \
        -D libexecdir=/usr/lib \
        -D sysconfdir=/etc \
        -D colord=no \
        -D gtk_doc=false \
        -D man=false \
        -D broadway_backend=true \
        -D wayland_backend=false \
        -D print_backends='file' \
        -D introspection=false \
        . build
    ninja -C build
}

package() {
    DESTDIR=${pkgdir} ninja -C build install
    sed -i -e 's/atk-bridge-2.0 //g' ${pkgdir}/usr/lib/pkgconfig/gtk+{,-x11,-broadway}-3.0.pc
}

after_install() {
    gtk-query-immodules-3.0 --update-cache
    glib-compile-schemas /usr/share/glib-2.0/schemas
}

after_upgrade() {
    after_install
}

generated_files="usr/lib/gtk-3.0/3.0.0/immodules.cache"
