pkgname=evince
pkgver=3.36.6
vcs=git
gittag=${pkgver}
relmon_id=8178
updater_rules="skip_odd_second"

build() {
    # disable gtk-doc
    sed -i -e '/help\//d' configure.ac
    sed -i -e '/GTK_DOC_CHECK/d' configure.ac
    sed -i -e '/help$/d' Makefile.am
    sed -i -e 's/po \\$/po/g' Makefile.am
    sed -i -e '/po \\/d' Makefile.am
    sed -i -e '/gtkdocize /d' autogen.sh
    rm -rf help

    export CFLAGS="${CFLAGS} -Wno-format-y2k -Wno-format-nonliteral"
    ./autogen.sh --prefix=/usr \
        --libexecdir=/usr/lib/evince \
        --disable-introspection \
        --disable-nautilus \
        --without-keyring \
        --disable-libgnome-desktop \
        --disable-browser-plugin \
        --disable-help \
        --disable-gtk-doc \
        --without-gspell \
        --disable-thumbnailer \
        --disable-comics \
        --disable-static
    sed -i -e 's/ po //g' Makefile
    make
}

package() {
    make DESTDIR=${pkgdir} install
    rm -rf ${pkgdir}/usr/share/help
}

after_install() {
    glib-compile-schemas /usr/share/glib-2.0/schemas
    update-desktop-database -q
    gtk-update-icon-cache -q -t -f /usr/share/icons/hicolor
}

after_upgrade() {
    after_install
}
